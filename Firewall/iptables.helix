# Generated by iptables-save v1.2.9 on Mon Nov 26 15:24:52 2007
*mangle
:PREROUTING ACCEPT [12710519:6358961048]
:INPUT ACCEPT [12673788:6357624564]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [11784774:2195314299]
:POSTROUTING ACCEPT [11784779:2195314698]
-A PREROUTING -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --sport 20 -j TOS --set-tos 0x08 
-A PREROUTING -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 20 -j TOS --set-tos 0x08 
-A PREROUTING -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --sport 80 -j TOS --set-tos 0x08 
-A PREROUTING -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 80 -j TOS --set-tos 0x08 
-A PREROUTING -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --sport 53 -j TOS --set-tos 0x10 
-A PREROUTING -p udp -m state --state NEW,RELATED,ESTABLISHED -m udp --dport 53 -j TOS --set-tos 0x10 
-A PREROUTING -p udp -m state --state NEW,RELATED,ESTABLISHED -m udp --dport 161 -j TOS --set-tos 0x04 
-A PREROUTING -p udp -m state --state NEW,RELATED,ESTABLISHED -m udp --dport 162 -j TOS --set-tos 0x04 
-A PREROUTING -p udp -m udp --dport 514 -j TOS --set-tos 0x04 
-A OUTPUT -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --sport 20 -j TOS --set-tos 0x08 
-A OUTPUT -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 20 -j TOS --set-tos 0x08 
-A OUTPUT -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --sport 80 -j TOS --set-tos 0x08 
-A OUTPUT -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 80 -j TOS --set-tos 0x08 
-A OUTPUT -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --sport 53 -j TOS --set-tos 0x10 
-A OUTPUT -p udp -m state --state NEW,RELATED,ESTABLISHED -m udp --dport 53 -j TOS --set-tos 0x10 
-A OUTPUT -p udp -m state --state NEW,RELATED,ESTABLISHED -m udp --dport 161 -j TOS --set-tos 0x04 
-A OUTPUT -p udp -m state --state NEW,RELATED,ESTABLISHED -m udp --dport 162 -j TOS --set-tos 0x04 
-A OUTPUT -p udp -m udp --dport 514 -j TOS --set-tos 0x04 
COMMIT
# Completed on Mon Nov 26 15:24:52 2007
# Generated by iptables-save v1.2.9 on Mon Nov 26 15:24:52 2007
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
:BlackList - [0:0]
:BlackListed - [0:0]
:Brian - [0:0]
:SESAM - [0:0]
:SFTP_SERVER - [0:0]
:STD_LOGIN - [0:0]
:USERS - [0:0]
:USERSaction - [0:0]
:WhiteList - [0:0]
:WhiteListed - [0:0]
:forward_dmz - [0:0]
:forward_ext - [0:0]
:forward_int - [0:0]
:input_dmz - [0:0]
:input_ext - [0:0]
:input_int - [0:0]
:reject_func - [0:0]
-A INPUT -i lo -j ACCEPT 
-A INPUT -i ! lo -j BlackList 
-A INPUT -i ! lo -j WhiteList 
-A INPUT -i eth0 -j STD_LOGIN 
-A INPUT -j Brian 
-A INPUT -j SFTP_SERVER 
-A INPUT -d 255.255.255.255 -i eth1 -p udp -m state --state NEW,ESTABLISHED -m udp --sport 68 --dport 67 -j ACCEPT 
-A INPUT -d 255.255.255.255 -i eth0 -j DROP 
-A INPUT -i eth0 -j input_ext 
-A INPUT -i eth1 -j input_int 
-A INPUT -d 192.75.158.137 -i eth1 -j LOG --log-prefix "SFW2-IN-ACC_DENIED_INT " --log-tcp-options --log-ip-options 
-A INPUT -d 192.75.158.137 -i eth1 -j DROP 
-A INPUT -j LOG --log-prefix "SFW2-IN-ILL-TARGET " --log-tcp-options --log-ip-options 
-A INPUT -j DROP 
-A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu 
-A FORWARD -i eth1 -o eth1 -j ACCEPT 
-A FORWARD -i eth0 -o eth0 -j ACCEPT 
-A FORWARD -i eth0 -j forward_ext 
-A FORWARD -i eth1 -j forward_int 
-A FORWARD -j LOG --log-prefix "SFW2-FWD-ILL-ROUTING " --log-tcp-options --log-ip-options 
-A FORWARD -j DROP 
-A FORWARD -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT 
-A FORWARD -j LOG --log-prefix "SFW2-FORWARD-ERROR " --log-tcp-options --log-ip-options 
-A OUTPUT -o lo -j ACCEPT 
-A OUTPUT -p icmp -m icmp --icmp-type 11 -j LOG --log-prefix "SFW2-OUT-TRACERT-ATTEMPT " --log-tcp-options --log-ip-options 
-A OUTPUT -p icmp -m icmp --icmp-type 11 -j ACCEPT 
-A OUTPUT -p icmp -m icmp --icmp-type 3/3 -j ACCEPT 
-A OUTPUT -p icmp -m icmp --icmp-type 3/4 -j ACCEPT 
-A OUTPUT -p icmp -m icmp --icmp-type 3/9 -j ACCEPT 
-A OUTPUT -p icmp -m icmp --icmp-type 3/10 -j ACCEPT 
-A OUTPUT -p icmp -m icmp --icmp-type 3/13 -j ACCEPT 
-A OUTPUT -p icmp -m icmp --icmp-type 3 -j DROP 
-A OUTPUT -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT 
-A OUTPUT -j LOG --log-prefix "SFW2-OUTPUT-ERROR " --log-tcp-options --log-ip-options 
-A BlackList -d 192.75.158.159 -i eth0 -j DROP 
-A BlackList -s ! 142.20.43.250 -i eth0 -p tcp -m multiport --dports 7937,7938 -j DROP 
-A BlackList -s ! 142.20.43.250 -i eth0 -p udp -m multiport --dports 7937,7938 -j DROP 
-A BlackList -i eth0 -o eth1 -j DROP 
-A BlackList -i eth1 -o eth0 -j DROP 
-A BlackList -s 192.36.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 192.38.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 59.0.0.0/255.0.0.0 -j BlackListed 
-A BlackList -s 222.0.0.0/255.0.0.0 -j BlackListed 
-A BlackList -s 129.115.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 200.50.126.232/255.255.255.248 -j BlackListed 
-A BlackList -s 203.91.120.0/255.255.248.0 -j BlackListed 
-A BlackList -s 209.200.168.64/255.255.255.224 -j BlackListed 
-A BlackList -s 213.201.44.28 -j BlackListed 
-A BlackList -s 140.109.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 140.110.0.0/255.254.0.0 -j BlackListed 
-A BlackList -s 140.112.0.0/255.240.0.0 -j BlackListed 
-A BlackList -s 140.128.0.0/255.248.0.0 -j BlackListed 
-A BlackList -s 140.136.0.0/255.254.0.0 -j BlackListed 
-A BlackList -s 140.138.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 219.96.0.0/255.224.0.0 -j BlackListed 
-A BlackList -s 222.106.83.0/255.255.255.0 -j BlackListed 
-A BlackList -s 59.76.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 200.30.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 211.233.14.0/255.255.255.0 -j BlackListed 
-A BlackList -s 192.244.208.0/255.255.240.0 -j BlackListed 
-A BlackList -s 210.127.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 62.193.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 192.107.75.0/255.255.255.0 -j BlackListed 
-A BlackList -s 8.3.218.0/255.255.255.0 -j BlackListed 
-A BlackList -s 8.3.219.0/255.255.255.0 -j BlackListed 
-A BlackList -s 200.21.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 60.28.13.0/255.255.255.0 -j BlackListed 
-A BlackList -s 89.64.0.0/255.240.0.0 -j BlackListed 
-A BlackList -s 67.50.0.0/255.254.0.0 -j BlackListed 
-A BlackList -s 211.115.110.0/255.255.255.0 -j BlackListed 
-A BlackList -s 207.234.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 212.179.128.0/255.255.224.0 -j BlackListed 
-A BlackList -s 87.69.224.0/255.255.224.0 -j BlackListed 
-A BlackList -s 200.113.160.0/255.255.224.0 -j BlackListed 
-A BlackList -s 84.12.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 61.128.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 219.242.0.0/255.254.0.0 -j BlackListed 
-A BlackList -s 210.188.216.0/255.255.255.0 -j BlackListed 
-A BlackList -s 222.80.0.0/255.252.0.0 -j BlackListed 
-A BlackList -s 219.94.80.0/255.255.240.0 -j BlackListed 
-A BlackList -s 89.212.6.0/255.255.255.0 -j BlackListed 
-A BlackList -s 203.146.127.0/255.255.255.0 -j BlackListed 
-A BlackList -s 67.50.0.0/255.254.0.0 -j BlackListed 
-A BlackList -s 213.190.34.0/255.255.255.0 -j BlackListed 
-A BlackList -s 222.199.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 81.252.11.160/255.255.255.248 -j BlackListed 
-A BlackList -s 212.180.0.0/255.255.128.0 -j BlackListed 
-A BlackList -s 202.5.192.0/255.255.192.0 -j BlackListed 
-A BlackList -s 58.60.0.0/255.252.0.0 -j BlackListed 
-A BlackList -s 195.153.104.192/255.255.255.192 -j BlackListed 
-A BlackList -s 83.14.110.184/255.255.255.248 -j BlackListed 
-A BlackList -s 218.210.0.0/255.254.0.0 -j BlackListed 
-A BlackList -s 202.96.47.0/255.255.255.0 -j BlackListed 
-A BlackList -s 219.238.88.0/255.255.255.0 -j BlackListed 
-A BlackList -s 202.138.96.0/255.255.224.0 -j BlackListed 
-A BlackList -s 213.186.40.0/255.255.248.0 -j BlackListed 
-A BlackList -s 81.216.192.0/255.255.192.0 -j BlackListed 
-A BlackList -s 221.214.0.0/255.254.0.0 -j BlackListed 
-A BlackList -s 217.67.137.104/255.255.255.248 -j BlackListed 
-A BlackList -s 82.114.12.0/255.255.255.0 -j BlackListed 
-A BlackList -s 82.114.12.0/255.255.255.0 -j BlackListed 
-A BlackList -s 222.203.0.0/255.255.0.0 -j BlackListed 
-A BlackList -s 66.115.0.0/255.255.192.0 -j BlackListed 
-A BlackList -s 60.24.0.0/255.252.0.0 -j BlackListed 
-A BlackList -s 60.28.0.0/255.255.192.0 -j BlackListed 
-A BlackList -s 218.234.32.0/255.255.255.224 -j BlackListed 
-A BlackList -s 202.28.0.0/255.254.0.0 -j BlackListed 
-A BlackListed -m limit --limit 1/min --limit-burst 10 -j LOG --log-prefix "SFW2-BLACKLISTED-DROP " 
-A BlackListed -j DROP 
-A Brian -s 142.20.0.0/255.255.0.0 -d 10.20.1.0/255.255.255.0 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m multiport --dports 80,443,10000 -j ACCEPT 
-A Brian -s 142.20.0.0/255.255.0.0 -d 192.75.158.137 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m multiport --dports 8080,6060,7070,3690 -m limit --limit 4/hour -j LOG --log-prefix "SFW2-ACC-HSC->HELIX-BRIAN " 
-A Brian -s 142.20.0.0/255.255.0.0 -d 192.75.158.137 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m multiport --dports 8080,6060,7070,3690 -j ACCEPT 
-A Brian -s 192.75.158.13 -d 192.75.158.137 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 6060 -m limit --limit 4/hour -j LOG --log-prefix "SFW2-ACC-HSC->HELIX-BRIAN " 
-A Brian -s 192.75.158.13 -d 192.75.158.137 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 6060 -j ACCEPT 
-A SFTP_SERVER -p tcp -m tcp --dport 339 -m limit --limit 4/hour -j LOG --log-prefix "SFW2-SFTP_SERVER-ACC " 
-A SFTP_SERVER -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 339 -j ACCEPT 
-A STD_LOGIN -i eth0 -p tcp -m state --state NEW,RELATED -m tcp --dport 206 -j LOG --log-prefix "SFW2-STD_LOGIN-ACC-SSH " 
-A STD_LOGIN -i eth0 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 206 -j ACCEPT 
-A STD_LOGIN -p tcp -m tcp --dport 22 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-WARN-SSH22-drop " --log-tcp-options --log-ip-options 
-A STD_LOGIN -p tcp -m tcp --dport 22 -j DROP 
-A STD_LOGIN -p tcp -m tcp --dport 22 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A STD_LOGIN -p tcp -m tcp --dport 22 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A USERS -p tcp -m tcp --dport 5432 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-USERS-ACC-TCP " --log-tcp-options --log-ip-options 
-A USERS -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 5432 -j USERSaction 
-A USERS -p tcp -m tcp --dport 5433 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-USERS-ACC-TCP " --log-tcp-options --log-ip-options 
-A USERS -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 5433 -j USERSaction 
-A USERS -p tcp -m tcp --dport 7102 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-USERS-ACC-TCP " --log-tcp-options --log-ip-options 
-A USERS -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 7102 -j USERSaction 
-A USERS -p tcp -m tcp --dport 7937 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-USERS-ACC-TCP " --log-tcp-options --log-ip-options 
-A USERS -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 7937 -j USERSaction 
-A USERSaction -j DROP 
-A WhiteList -s 142.20.81.133 -d 192.75.158.137 -i eth0 -p tcp -m tcp --dport 25 -j WhiteListed 
-A WhiteList -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -m multiport --dports 7937,7938 -j LOG --log-prefix "SFW2-WhiteList-ACC-TCP " --log-tcp-options --log-ip-options 
-A WhiteList -p tcp -m state --state NEW,RELATED,ESTABLISHED -m multiport --dports 7937,7938 -j WhiteListed 
-A WhiteListed -m state --state NEW,RELATED,ESTABLISHED -j LOG --log-prefix "SFW2-WListed-ACC " 
-A WhiteListed -i eth0 -p tcp -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT 
-A forward_ext -d 10.20.1.1 -j LOG --log-prefix "SFW2-FWDext-DROP-CIRCUMV " --log-tcp-options --log-ip-options 
-A forward_ext -d 10.20.1.1 -j DROP 
-A forward_ext -p icmp -m state --state RELATED -m icmp --icmp-type 3 -j ACCEPT 
-A forward_ext -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 0 -j ACCEPT 
-A forward_ext -o eth0 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT 
-A forward_ext -i eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A forward_ext -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-FWDext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_ext -p icmp -m icmp --icmp-type 4 -j LOG --log-prefix "SFW2-FWDext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_ext -p icmp -m icmp --icmp-type 5 -j LOG --log-prefix "SFW2-FWDext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_ext -p icmp -m icmp --icmp-type 8 -j LOG --log-prefix "SFW2-FWDext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_ext -p icmp -m icmp --icmp-type 13 -j LOG --log-prefix "SFW2-FWDext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_ext -p icmp -m icmp --icmp-type 17 -j LOG --log-prefix "SFW2-FWDext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_ext -p udp -j LOG --log-prefix "SFW2-FWDext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_ext -m state --state INVALID -j LOG --log-prefix "SFW2-FWDext-DROP-DEFLT-INV " --log-tcp-options --log-ip-options 
-A forward_ext -j DROP 
-A forward_int -d 192.75.158.137 -j LOG --log-prefix "SFW2-FWDint-DROP-CIRCUMV " --log-tcp-options --log-ip-options 
-A forward_int -d 192.75.158.137 -j DROP 
-A forward_int -p icmp -m state --state RELATED -m icmp --icmp-type 3 -j ACCEPT 
-A forward_int -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 0 -j ACCEPT 
-A forward_int -o eth0 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT 
-A forward_int -i eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A forward_int -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-FWDint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_int -p icmp -m icmp --icmp-type 4 -j LOG --log-prefix "SFW2-FWDint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_int -p icmp -m icmp --icmp-type 5 -j LOG --log-prefix "SFW2-FWDint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_int -p icmp -m icmp --icmp-type 8 -j LOG --log-prefix "SFW2-FWDint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_int -p icmp -m icmp --icmp-type 13 -j LOG --log-prefix "SFW2-FWDint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_int -p icmp -m icmp --icmp-type 17 -j LOG --log-prefix "SFW2-FWDint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_int -p udp -j LOG --log-prefix "SFW2-FWDint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A forward_int -m state --state INVALID -j LOG --log-prefix "SFW2-FWDint-DROP-DEFLT-INV " --log-tcp-options --log-ip-options 
-A forward_int -j DROP 
-A input_ext -p icmp -m icmp --icmp-type 4 -j LOG --log-prefix "SFW2-INext-ACC-SOURCEQUENCH " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 4 -j ACCEPT 
-A input_ext -p icmp -m icmp --icmp-type 8 -j ACCEPT 
-A input_ext -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 0 -j ACCEPT 
-A input_ext -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 3 -j ACCEPT 
-A input_ext -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 11 -j ACCEPT 
-A input_ext -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 12 -j ACCEPT 
-A input_ext -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 14 -j ACCEPT 
-A input_ext -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 18 -j ACCEPT 
-A input_ext -p icmp -m icmp --icmp-type 5 -j LOG --log-prefix "SFW2-INext-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 4 -j LOG --log-prefix "SFW2-INext-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 13 -j LOG --log-prefix "SFW2-INext-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 17 -j LOG --log-prefix "SFW2-INext-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 2 -j LOG --log-prefix "SFW2-INext-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -j DROP 
-A input_ext -p tcp -m tcp --dport 111 -j LOG --log-prefix "SFW2-INext-DROP-TCP-p111 " 
-A input_ext -p tcp -m tcp --dport 111 -j DROP 
-A input_ext -p tcp -m tcp --dport 123 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-ACC-TCP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 123 -j ACCEPT 
-A input_ext -p tcp -m tcp --dport 113 --tcp-flags SYN,RST,ACK SYN -j reject_func 
-A input_ext -p tcp -m tcp --dport 389 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 389 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 427 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 427 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 514 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 514 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 619 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 619 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 843 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 843 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 888 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 888 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 924 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 924 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 1029 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 1029 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 2049 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 2049 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 15001 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 15001 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 15002 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 15002 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m tcp --dport 15003 --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m tcp --dport 15003 --tcp-flags SYN,RST,ACK SYN -j DROP 
-A input_ext -p tcp -m state --state RELATED,ESTABLISHED -m tcp --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-ACC-HiTCP " --log-tcp-options --log-ip-options 
-A input_ext -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A input_ext -p udp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A input_ext -p udp -m state --state NEW -m udp --dport 22 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 67 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 67 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 111 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 123 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 123 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 123 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 389 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 389 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 427 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 427 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 514 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 616 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 619 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 840 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 843 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 886 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 888 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 921 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 924 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 928 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1022 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1023 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1024 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1026 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1028 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1029 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1029 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1030 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1031 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1032 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1033 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1034 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1035 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 1036 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 2049 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 2049 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 5353 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 7938 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 15001 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 15001 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 15002 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 15003 -j DROP 
-A input_ext -p udp -m state --state NEW -m udp --dport 15003 -j DROP 
-A input_ext -p udp -m state --state ESTABLISHED -m udp --dport 61000:65095 -j ACCEPT 
-A input_ext -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 4 -j LOG --log-prefix "SFW2-INext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 5 -j LOG --log-prefix "SFW2-INext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 8 -j LOG --log-prefix "SFW2-INext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 13 -j LOG --log-prefix "SFW2-INext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_ext -p icmp -m icmp --icmp-type 17 -j LOG --log-prefix "SFW2-INext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_ext -p udp -j LOG --log-prefix "SFW2-INext-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_ext -m state --state INVALID -j LOG --log-prefix "SFW2-INext-DROP-DEFLT-INV " --log-tcp-options --log-ip-options 
-A input_ext -j DROP 
-A input_int -j ACCEPT 
-A input_int -p icmp -m icmp --icmp-type 8 -j ACCEPT 
-A input_int -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 0 -j ACCEPT 
-A input_int -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 3 -j ACCEPT 
-A input_int -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 11 -j ACCEPT 
-A input_int -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 12 -j ACCEPT 
-A input_int -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 14 -j ACCEPT 
-A input_int -p icmp -m state --state RELATED,ESTABLISHED -m icmp --icmp-type 18 -j ACCEPT 
-A input_int -p icmp -m icmp --icmp-type 5 -j LOG --log-prefix "SFW2-INint-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 4 -j LOG --log-prefix "SFW2-INint-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 13 -j LOG --log-prefix "SFW2-INint-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 17 -j LOG --log-prefix "SFW2-INint-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 2 -j LOG --log-prefix "SFW2-INint-DROP-ICMP-CRIT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -j DROP 
-A input_int -p tcp -m tcp --dport 113 --tcp-flags SYN,RST,ACK SYN -j reject_func 
-A input_int -p tcp -m state --state RELATED,ESTABLISHED -m tcp --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INint-ACC-HiTCP " --log-tcp-options --log-ip-options 
-A input_int -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A input_int -p udp -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A input_int -p tcp -m tcp --tcp-flags SYN,RST,ACK SYN -j LOG --log-prefix "SFW2-INint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 4 -j LOG --log-prefix "SFW2-INint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 5 -j LOG --log-prefix "SFW2-INint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 8 -j LOG --log-prefix "SFW2-INint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 13 -j LOG --log-prefix "SFW2-INint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_int -p icmp -m icmp --icmp-type 17 -j LOG --log-prefix "SFW2-INint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_int -p udp -j LOG --log-prefix "SFW2-INint-DROP-DEFLT " --log-tcp-options --log-ip-options 
-A input_int -m state --state INVALID -j LOG --log-prefix "SFW2-INint-DROP-DEFLT-INV " --log-tcp-options --log-ip-options 
-A input_int -j DROP 
-A reject_func -p tcp -j REJECT --reject-with tcp-reset 
-A reject_func -p udp -j REJECT --reject-with icmp-port-unreachable 
-A reject_func -j REJECT --reject-with icmp-proto-unreachable 
COMMIT
# Completed on Mon Nov 26 15:24:52 2007
# Generated by iptables-save v1.2.9 on Mon Nov 26 15:24:52 2007
*nat
:PREROUTING ACCEPT [44958:1972810]
:POSTROUTING ACCEPT [17987:1677934]
:OUTPUT ACCEPT [0:0]
:SESAM - [0:0]
:kc - [0:0]
:kc1 - [0:0]
:kc2 - [0:0]
-A PREROUTING -i eth0 -p tcp -m state --state INVALID,NEW,RELATED,UNTRACKED -m multiport --dports 22222,80,21,990 -j SESAM 
-A PREROUTING -d 192.75.158.137 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 339 -m limit --limit 2/min -j LOG --log-prefix "SFW2-SFTP_SERVER-ACC-PRE " 
-A PREROUTING -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 339 -j ACCEPT 
-A PREROUTING -d 192.75.158.137 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 339 -j DNAT --to-destination :206 
-A PREROUTING -d 192.75.158.137 -s 142.20.0.0/255.255.0.0 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 80 -j DNAT --to-destination 10.20.1.19 
-A PREROUTING -d 192.75.158.137 -s 142.20.0.0/255.255.0.0 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 443 -j DNAT --to-destination 10.20.1.19 
-A PREROUTING -d 192.75.158.137 -s 142.20.0.0/255.255.0.0 -p tcp -m state --state NEW,RELATED,ESTABLISHED -m tcp --dport 10000 -j DNAT --to-destination 10.20.1.19 
-A PREROUTING 
-A POSTROUTING -o eth0 -j MASQUERADE 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 22222 -m recent --rcheck --seconds 10 --name portKnock --rsource -j kc 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 80 -m recent --set --name portKnock2 --rsource -j DROP 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 21 -m recent --rcheck --seconds 10 --name portKnock2 --rsource -j kc1 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 990 -m recent --rcheck --seconds 10 --name portKnock1 --rsource -j kc2 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 79 -m recent --remove --name portKnock2 --rsource -j DROP 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 81 -m recent --remove --name portKnock2 --rsource -j DROP 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 20 -m recent --remove --name portKnock1 --rsource -j DROP 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 22 -m recent --remove --name portKnock1 --rsource -j DROP 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 989 -m recent --remove --name portKnock --rsource -j DROP 
-A SESAM -p tcp -m state --state NEW -m tcp --dport 991 -m recent --remove --name portKnock --rsource -j DROP 
-A SESAM -j DROP 
-A kc -m recent --update --name portKnock --rsource -j LOG --log-prefix "SFW2-SESAMKNOCK-ACC-TCP " 
-A kc -p tcp -m recent --remove --name portKnock --rsource -j DNAT --to-destination :206 
-A kc1 -m recent --remove --name portKnock2 --rsource 
-A kc1 -m recent --set --name portKnock1 --rsource -j DROP 
-A kc2 -m recent --remove --name portKnock1 --rsource 
-A kc2 -m recent --set --name portKnock --rsource -j DROP 
COMMIT
# Completed on Mon Nov 26 15:24:52 2007
